<!DOCTYPE html>
<html>
<head>
    <title>M3U Playlist Generator</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
        h1 { color: #333; }
        .url-box { background: #f0f0f0; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .url-box code { background: #fff; padding: 10px; display: block; word-break: break-all; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #4CAF50; color: white; }
        .btn { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
        .btn:hover { background: #45a049; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body>
    <h1>üé¨ M3U Playlist Manager</h1>
    
    <div class="url-box">
        <strong>Your M3U Playlist URL:</strong>
        <code id="playlistUrl">Loading...</code>
    </div>

    <h2>Videos</h2>
    <table id="videoTable">
        <thead>
            <tr>
                <th>Title</th>
                <th>URL</th>
                <th>Duration (sec)</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="videoList"></tbody>
    </table>

    <button class="btn" onclick="addRow()">+ Add Video</button>
    <button class="btn" onclick="saveVideos()">üíæ Save & Update Playlist</button>

    <script>
        const GITHUB_USER = 'wizzzzard333-ctrl';
        const REPO = 'm3u-playlist';
        const FILE = 'videos.json';
        
        let videos = [];
        let fileSha = '';

        document.getElementById('playlistUrl').textContent = 
            `https://${GITHUB_USER}.github.io/${REPO}/playlist.m3u`;

        async function loadVideos() {
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${FILE}`);
                const data = await response.json();
                fileSha = data.sha;
                videos = JSON.parse(atob(data.content));
                renderTable();
            } catch (error) {
                console.error('Error loading videos:', error);
            }
        }

        function renderTable() {
            const tbody = document.getElementById('videoList');
            tbody.innerHTML = videos.map((video, index) => `
                <tr>
                    <td><input type="text" value="${video.title}" onchange="updateVideo(${index}, 'title', this.value)"></td>
                    <td><input type="text" value="${video.url}" onchange="updateVideo(${index}, 'url', this.value)"></td>
                    <td><input type="number" value="${video.duration}" onchange="updateVideo(${index}, 'duration', this.value)"></td>
                    <td><button class="btn" onclick="deleteVideo(${index})">Delete</button></td>
                </tr>
            `).join('');
        }

        function updateVideo(index, field, value) {
            videos[index][field] = field === 'duration' ? parseInt(value) : value;
        }

        function addRow() {
            videos.push({ title: 'New Video', url: 'https://example.com/video.mp4', duration: 0 });
            renderTable();
        }

        function deleteVideo(index) {
            videos.splice(index, 1);
            renderTable();
        }

        async function saveVideos() {
            const token = prompt('Enter your GitHub Personal Access Token:');
            if (!token) return;

            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${FILE}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update video list',
                        content: btoa(JSON.stringify(videos, null, 2)),
                        sha: fileSha
                    })
                });

                if (response.ok) {
                    alert('‚úÖ Videos saved! Playlist will update in ~30 seconds.');
                    loadVideos();
                } else {
                    alert('‚ùå Error saving. Check your token.');
                }
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }

        loadVideos();
    </script>
</body>
</html>